<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Doughnut Chart: Industrias m√°s atacadas</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f9f9f9;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      padding-top: 40px;
    }
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.75);
      color: #fff;
      padding: 6px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .legend {
      font-size: 13px;
      margin-left: 30px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    .legend-color {
      width: 12px;
      height: 12px;
      margin-right: 8px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div id="chart"></div>
  <div class="tooltip" id="tooltip"></div>
  <div class="legend" id="legend"></div>

  <script>
    const data = [
      { industry: "Public Administration", count: 136 },
      { industry: "Finance and Insurance", count: 58 },
      { industry: "Other Services (except Public Administration)", count: 47 },
      { industry: "Information", count: 25 },
      { industry: "Professional, Scientific, and Technical Services", count: 23 },
      { industry: "Retail Trade", count: 18 },
      { industry: "Manufacturing", count: 17 },
      { industry: "Utilities", count: 17 },
      { industry: "Mining, Quarryng, and Oil and Gas Extraction", count: 16 },
      { industry: "Educational Services", count: 12 },
      { industry: "Arts, Entertaiment, and Recreation", count: 11 },
      { industry: "Health Care and Social Assistance", count: 11 },
      { industry: "Transportation and Warehousing", count: 10 },
      { industry: "Accommodation and Food Services", count: 8 }
    ];

    const width = 500, height = 500, margin = 50;
    const radius = Math.min(width, height) / 2 - margin;

    const svg = d3.select("#chart")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", `translate(${width / 2}, ${height / 2})`);

    const tooltip = d3.select("#tooltip");

    const color = d3.scaleOrdinal()
      .domain(data.map(d => d.industry))
      .range(d3.schemeTableau10);

    const pie = d3.pie()
      .sort(null)
      .value(d => d.count);

    const arc = d3.arc()
      .innerRadius(radius * 0.5)
      .outerRadius(radius);

    svg.selectAll('path')
      .data(pie(data))
      .enter()
      .append('path')
      .attr('d', arc)
      .attr('fill', d => color(d.data.industry))
      .attr('stroke', 'white')
      .style('stroke-width', '2px')
      .on("mouseover", (event, d) => {
        tooltip.style("opacity", 1)
          .html(`<strong>${d.data.industry}</strong><br>Ataques: ${d.data.count}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 20) + "px");
      })
      .on("mousemove", event => {
        tooltip.style("left", (event.pageX + 10) + "px")
               .style("top", (event.pageY - 20) + "px");
      })
      .on("mouseout", () => tooltip.style("opacity", 0));

    svg.selectAll('text')
      .data(pie(data))
      .enter()
      .append('text')
      .text(d => d.data.count)
      .attr("transform", d => `translate(${arc.centroid(d)})`)
      .style("text-anchor", "middle")
      .style("font-size", "12px")
      .style("fill", "#fff")
      .style("font-weight", "bold");

    const legend = d3.select("#legend");
    data.forEach(d => {
      legend.append("div")
        .attr("class", "legend-item")
        .html(`<span class="legend-color" style="background:${color(d.industry)}"></span>${d.industry}`);
    });
  </script>
</body>
</html>